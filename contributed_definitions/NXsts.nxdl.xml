<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2023-2025 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<!--
https://thesis.library.caltech.edu/1943/4/03chapter3.pdf
TODO: Replace rename NXenvironment to experiment_environment in NXstm, NXspm and NXafm-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="application" type="group" name="NXsts" extends="NXspm" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <doc>
        An application definition to describe Scanning Tunneling Spectroscopy (STS).
        
        The NXsts is duplication of NXspm and is considered as a proxy application definition
        for Scanning Tunneling Spectroscopy (STS) technique.
    </doc>
    <group type="NXentry">
        <field name="definition">
            <doc>
                Name of the definition that is used for the application.
            </doc>
            <enumeration>
                <item value="NXsts"/>
            </enumeration>
        </field>
        <field name="scan_mode">
            <doc>
                The mode between the tip and sample of the tunneling spectroscopy experiment.
            </doc>
            <enumeration open="true">
                <item value="constant_height"/>
                <item value="constant_current"/>
                <item value="constant_spacing"/>
            </enumeration>
        </field>
        <group name="experiment_instrument" type="NXinstrument">
            <doc>
                The instrument information.
            </doc>
            <group name="lockin_amplifier" type="NXlockin" optional="true">
                <doc>
                    The lock-in amplifier information.
                </doc>
            </group>
            <group name="current_sensor" type="NXsensor" optional="true">
                <doc>
                    Information for current sensor.
                </doc>
                <field name="current" type="NX_NUMBER" units="NX_CURRENT">
                    <doc>
                        The dc current between tip and sample.
                    </doc>
                </field>
                <field name="current_offset" type="NX_NUMBER" optional="true" units="NX_CURRENT">
                    <doc>
                        The offset in the tunneling current between tip and sample.
                    </doc>
                </field>
                <group name="current_calibration" type="NXcalibration" optional="true">
                    <doc>
                        Calibration data of the current sensor.
                    </doc>
                    <field name="coefficients" type="NX_NUMBER" optional="true" units="NX_ANY">
                        <doc>
                            The coefficients of the calibration.
                        </doc>
                    </field>
                </group>
                <group type="NXamplifier" optional="true">
                    <doc>
                        An amplifier information for the input signal (e.g. from tip).
                    </doc>
                    <field name="current_gain" type="NX_NUMBER" units="NX_UNITLESS" optional="true">
                        <doc>
                            The gain of the current sensor.
                        </doc>
                    </field>
                </group>
            </group>
            <group name="voltage_sensor" type="NXsensor" optional="true">
                <doc>
                    The sensor information for the voltage device.
                </doc>
                <field name="voltage" type="NX_NUMBER" units="NX_VOLTAGE">
                    <doc>
                        The dc voltage between tip and sample.
                    </doc>
                </field>
                <field name="voltage_offset" type="NX_NUMBER" optional="true" units="NX_VOLTAGE">
                    <doc>
                        The offset in the tunneling voltage between tip and sample.
                    </doc>
                </field>
                <group name="voltage_calibration" type="NXcalibration" optional="true">
                    <doc>
                        Calibration data of the voltage sensor.
                    </doc>
                    <field name="coefficients" type="NX_NUMBER" optional="true" units="NX_ANY">
                        <doc>
                            The coefficients of the calibration.
                        </doc>
                    </field>
                </group>
                <group type="NXamplifier" optional="true">
                    <doc>
                        An amplifier information for the input signal (e.g. from tip).
                    </doc>
                    <field name="voltage_gain" type="NX_NUMBER" units="NX_UNITLESS" optional="true">
                        <doc>
                            The gain of the voltage sensor.
                        </doc>
                    </field>
                </group>
            </group>
            <group name="piezo_sensor" type="NXsensor">
                <doc>
                    The piezo sensor refers to the height (or Z) piezo sensor if nothing is
                    mentioned along the X and Y directions.
                </doc>
                <field name="x" type="NX_NUMBER" units="NX_LENGTH">
                    <doc>
                        The x position of the piezo. In STS experiment, the piezo stays fixed at
                        x,y and z and the the tunneling current is measured with respect to the
                        bias voltage (sweep voltage).
                    </doc>
                </field>
                <field name="y" type="NX_NUMBER" units="NX_LENGTH">
                    <doc>
                        The y position of the piezo.
                    </doc>
                </field>
                <field name="z" type="NX_NUMBER" units="NX_LENGTH">
                    <doc>
                        The z position of the piezo.
                    </doc>
                </field>
                <group name="piezo_configuration" type="NXpiezo_config_spm" optional="true">
                    <doc>
                        The piezo configuration information like piezoelectric calibration and material
                        properties.
                    </doc>
                    <group name="calibration" type="NXcalibration" optional="true">
                        <doc>
                            Calibration of the piezo device.
                        </doc>
                    </group>
                </group>
                <group type="NXpositioner_spm">
                    <doc>
                        The positioner information like the position of the tip, the position of the
                        sample, PID loop feedback etc.
                    </doc>
                    <group name="z_controller" type="NXpid_controller">
                        <doc>
                            The PID controller information for the z-axis.
                        </doc>
                        <field name="z" type="NX_NUMBER">
                            <doc>
                                To indicate the relative tip position z between tip and sample. The tip position
                                can also be varied when the z_controller is not running.
                            </doc>
                        </field>
                        <field name="controller_status" type="NX_BOOLEAN">
                            <doc>
                                Status if controller is active.
                            </doc>
                        </field>
                    </group>
                </group>
                <group name="piezo_material" type="NXpiezoelectric_material" optional="true">
                    <doc>
                        The material description and properties of the piezoelectric scanner materials.
                    </doc>
                </group>
            </group>
            <group name="TEMPERATURE" type="NXsensor" nameType="any" optional="true">
                <doc>
                    A group handling the temperature such as cryo, shield and tip. For different
                    type of temperature sensors repeat this group.
                </doc>
                <field name="temperature" type="NX_NUMBER" optional="true" units="NX_TEMPERATURE">
                    <doc>
                        The temperature of the sample.
                    </doc>
                </field>
                <field name="CHANNEL_temp" type="NX_CHAR" nameType="partial" optional="true">
                    <doc>
                        The name of the channel to measure the temperature.
                    </doc>
                </field>
                <group name="temperature_calibration" type="NXcalibration" optional="true">
                    <doc>
                        Calibration of the temperature measurement.
                    </doc>
                    <field name="coefficients" type="NX_NUMBER" units="NX_ANY">
                        <doc>
                            The coefficients of the calibration.
                        </doc>
                    </field>
                </group>
                <group name="TEMPERATURE_DATA" type="NXdata" nameType="any" optional="true">
                    <doc>
                        Data (e.g, record from SPM head temperature) from temperature sensor.
                    </doc>
                </group>
            </group>
            <group name="bias_spectroscopy_environment" type="NXenvironment">
                <doc>
                    To explain bias (sweep measurement) voltage applied to the sample.
                </doc>
                <group type="NXbias_spectroscopy">
                    <doc>
                        Setup and scan data for continuous measurement of bias-voltage on the subject of experiment
                        vs tunneling current from probe.
                    </doc>
                    <group type="NXpositioner_spm" optional="true">
                        <doc>
                            The positioner information like the position of the tip, PID loop feedback etc.
                        </doc>
                        <group name="z_controller" type="NXpid_controller" optional="true">
                            <doc>
                                The PID controller information for the z-axis.
                            </doc>
                            <field name="z_average_time" type="NX_NUMBER" optional="true" units="NX_TIME">
                                <doc>
                                    The average time taken by the z-controller to stabilize the tip.
                                </doc>
                            </field>
                            <field name="z_controller_time" type="NX_NUMBER" optional="true" units="NX_TIME">
                                <doc>
                                    The time taken by the z-controller to measure physical properties.
                                </doc>
                            </field>
                            <field name="z_controller_hold" type="NX_BOOLEAN" optional="true">
                                <doc>
                                    The status of the controller to be held on the previous position, before going to the
                                    next scan point or line to measure the physical properties.
                                </doc>
                            </field>
                            <field name="record_final_z" type="NX_BOOLEAN" optional="true">
                                <doc>
                                    The status of the controller to record the final z position after the scan.
                                </doc>
                            </field>
                        </group>
                    </group>
                    <group name="bias_sweep" type="NXbias_sweep">
                        <doc>
                            The bais voltage sweep is a common technique used on the substance or sample or environment
                            to study the change in the behavior of the sample or substance or environment due to change
                            in applied  bias voltage.
                        </doc>
                        <group name="scan_region" type="NXobject">
                            <doc>
                                The scan region (phase space or sub-phase space) is the region where the scan is
                                performed.
                            </doc>
                            <field name="scan_offset_bias" type="NX_NUMBER" optional="true" units="NX_VOLTAGE">
                                <doc>
                                    The offset of the bias voltage for bias sweep.
                                </doc>
                            </field>
                            <field name="scan_range_bias" type="NX_NUMBER" optional="true" units="NX_VOLTAGE">
                                <doc>
                                    The range of the scan is the length of the bias voltage over which the sweep
                                    scan will be performed.
                                </doc>
                            </field>
                            <field name="scan_start_bias" type="NX_NUMBER" units="NX_VOLTAGE">
                                <doc>
                                    The start of the bias scan voltage.
                                </doc>
                            </field>
                            <field name="scan_end_bias" type="NX_NUMBER" units="NX_VOLTAGE">
                                <doc>
                                    The end of the bias scan voltage.
                                </doc>
                            </field>
                        </group>
                        <group name="linear_sweep" type="NXobject">
                            <doc>
                                The linear sweep is a type of scan where the bias voltage is swept
                                linearly from the starting voltage to the ending voltage.
                            </doc>
                            <field name="scan_points_bias" type="NX_NUMBER">
                                <doc>
                                    The number of voltage points the sweep scan to be performed.
                                </doc>
                            </field>
                            <field name="step_size_bias" type="NX_NUMBER" units="NX_VOLTAGE">
                                <doc>
                                    The step size of the sweep.
                                    The step size is the difference between the two consecutive bias voltage during the sweep.
                                </doc>
                            </field>
                            <field name="reset_bias" type="NX_BOOLEAN" optional="true">
                                <doc>
                                    The reset_bias is used to reset the bias voltage to the starting value after a
                                    sweep is completed.
                                </doc>
                            </field>
                        </group>
                    </group>
                </group>
            </group>
            <group name="sample_bias_votage" type="NXsensor" optional="true">
                <doc>
                    The DC bias voltage that is applied to the sample.
                </doc>
                <field name="bias_voltage" type="NX_NUMBER" units="NX_VOLTAGE">
                    <doc>
                        The bias voltage (DC) applied to the sample.
                    </doc>
                </field>
                <field name="bias_offset" type="NX_NUMBER" optional="true" units="NX_VOLTAGE">
                    <doc>
                        Offset value of the bias voltage.
                    </doc>
                </field>
                <group name="bias_calibration" type="NXcalibration" optional="true">
                    <doc>
                        Calibration of the bias voltage measurement (V/V).
                    </doc>
                    <field name="coefficients" type="NX_NUMBER" optional="true" units="NX_ANY">
                        <doc>
                            The coefficients of the calibration.
                        </doc>
                    </field>
                </group>
            </group>
        </group>
        <group name="reproducibility_indicators" type="NXcollection" optional="true">
            <doc>
                The group's concepts hold the link to the related concepts that define the
                reproducibility of the STM experiment.
            </doc>
            <field name="current" type="NX_NUMBER" optional="true">
                <doc>
                    The tunneling current between tip and sample after application of bias voltage.
                    link to the target:
                    /ENTRY[entry]/experiment_instrument/current_sensor/current
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <field name="current_offset" type="NX_NUMBER" optional="true">
                <doc>
                    The offset in tunneling current between tip and sample after application of bias voltage.
                    link to the target:
                    /ENTRY[entry]/experiment_instrument/current_sensor/current
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <field name="current_gain" type="NX_NUMBER" optional="true">
                <doc>
                    Proportional relationship between the probe output voltage and the actual
                    tunneling current when measuring the tunneling current.
                    link to the target:
                    /ENTRY[entry]/experiment_instrument/current_sensor/amplifier/current_gain
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <group name="bias_sweep" type="NXobject" optional="true">
                <doc>
                    Bias sweep measurement in bias spectroscopy.
                    Link to target:
                    /ENTRY[entry]/experiment_instrument/bias_spectroscopy_environment/BIAS_SPECTROSCOPY[bias_spectroscopy]/BIAS_SWEEP[bias_sweep]
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </group>
            <field name="modulation_signal_type" optional="true">
                <doc>
                    This is the signal on which the modulation voltage or current will be added.
                    link to the target:
                    /ENTRY[entry]/experiment_instrument/lockin_amplifier/modulation_signal_type
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <field name="modulation_frequency" type="NX_NUMBER" optional="true">
                <doc>
                    The frequency of the sine modulation that is used to modulate the signal in lock-in.
                    link to the target:
                    /ENTRY[entry]/experiment_instrument/lockin_amplifier/modulation_frequency
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
        </group>
        <group name="resolution_indicators" type="NXcollection" optional="true">
            <doc>
                The group's concepts hold the link to the related concepts that define the
                resolution of the STM experiment.
            </doc>
            <field name="tip_temp" type="NX_NUMBER" optional="true">
                <doc>
                    Link to target:
                    /ENTRY[entry]/experiment_instrument/scan_environment/tip_temp
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <field name="cryo_bottom_temp" type="NX_NUMBER" optional="true">
                <doc>
                    Link to target:
                    /ENTRY[entry]/experiment_instrument/scan_environment/cryo_bottom_temp
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <field name="cryo_shield_temp" type="NX_NUMBER" optional="true">
                <doc>
                    Link to target:
                    /ENTRY[entry]/experiment_instrument/scan_environment/cryo_shield_temp
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <group name="bias_sweep" type="NXobject" optional="true">
                <doc>
                    Link to target:
                    /ENTRY[entry]/experiment_instrument/bias_spectroscopy_environment/BIAS_SPECTROSCOPY[bias_spectroscopy]/BIAS_SWEEP[bias_sweep]
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </group>
            <field name="modulation_signal_type" optional="true">
                <doc>
                    This is the signal on which the modulation voltage or current will be added.
                    link to the target:
                    /ENTRY[entry]/experiment_instrument/lockin_amplifier/modulation_signal_type
                    
                    Note: group name (e.g. entry in ENTRY[entry]) inside the square bracket would be the exact instancename of the base class (e.g. NXentry).
                </doc>
            </field>
            <field name="modulation_frequency" type="NX_NUMBER" optional="true">
                <doc>
                    The frequency of the sine modulation that is used to modulate the signal in lock-in.
                    link to the target:
                    /ENTRY[entry]/experiment_instrument/lockin_amplifier/modulation_frequency
                </doc>
            </field>
        </group>
    </group>
</definition>
