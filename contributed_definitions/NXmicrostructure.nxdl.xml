<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2014-2024 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="base" type="group" name="NXmicrostructure" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <symbols>
        <doc>
             The symbols used in the schema to specify e.g. dimensions of arrays.
        </doc>
        <!--one-dimensional observations and so-called linear intercept analysis we observe
one-dimensional sections of either projections (see below) or true one-dimensional cuts across a volume of material-->
        <symbol name="n_icept">
            <doc>
                 The number of linear intercepts defined.
            </doc>
        </symbol>
        <symbol name="n_c_one">
            <doc>
                 The number of crystal projections segmented by crossing (projected or real)
                 interfaces.
            </doc>
        </symbol>
        <symbol name="n_i_one">
            <doc>
                 The number of crossings
            </doc>
        </symbol>
        <!--two-dimensional projections of three-dimensional objects using E. E. Underwood notation
crystals/grains are projections that are delineated by projections of interface, i.e. interface lines which meet at projections of triple lines aka triple points-->
        <symbol name="n_c_two">
            <doc>
                 The number of crystal projections.
            </doc>
        </symbol>
        <symbol name="n_i_two">
            <doc>
                 The number of interface projections.
            </doc>
        </symbol>
        <symbol name="n_t_two">
            <doc>
                 The number of assumed triple line projections aka triple points.
            </doc>
        </symbol>
        <!--three-dimensional real objects, volumetrically characterized
crystals are delineated by interfaces that are delineated by triple lines that meet at quad junctions-->
        <symbol name="n_c">
            <doc>
                 The number of crystals. Grain and sub-grain are synonyms for crystal.
            </doc>
        </symbol>
        <symbol name="n_i">
            <doc>
                 The number of interfaces. Grain boundary and phase boundary are subclasses of
                 interface.
            </doc>
        </symbol>
        <symbol name="n_t">
            <doc>
                 The number of triple lines.
            </doc>
        </symbol>
        <symbol name="n_q">
            <doc>
                 The number of quadruple junctions.
            </doc>
        </symbol>
    </symbols>
    <doc>
         Base class to describe structural aspects and associated descriptors of (micro)structural features.
         
         The continuum or atomic scale description of materials is inherently a model of reality. Such models
         are useful as they enable a coarse graining and categorization of measured or simulated materials
         specifically how their structural features lead to properties i.e. descriptor values.
         Mind that most specimens are thermo-chemo-mechanically treated before they are characterized.
         Therefore, the characterized microstructure may not have probed the same structure as of
         the untreated sample or often bulk material from which the region-of-interest or specimen was probed.
         
         A simulation or experiment can only sample the true structure of the material.
         Fields time and increment enable a quantification of the temporal evolution of a material
         when using multiple instances of NXmicrostructure.
         
         Taking inspiration from `E. E. Underwood &lt;https://doi.org/10.1111/j.1365-2818.1972.tb03709.x&gt;`_
         and E. E. Underwood's book on Quantitative stereology that was published in 1970.
         
         Identifiers can be defined either implicitly or explicitly. For implicit indexing identifiers are defined
         on the interval :math:`[identifier\_offset, identifier\_offset + cardinality - 1]`.
    </doc>
    <!--as e.g. a result of one grain reconstruction with an algorithm with MTex or the grain/phase i.e. interface network reconstruction software in commercial tools
the idea is we may wish to run as many grain reconstructions as we want and add details about the processing used for each of them if needed-->
    <field name="comment" type="NX_CHAR">
        <doc>
             Discouraged free text field for leaving comments.
        </doc>
    </field>
    <field name="time" type="NX_NUMBER" units="NX_TIME">
        <doc>
             Measured or simulated physical time stamp for this snapshot.
             Not to be confused with wall-clock timing or profiling data.
        </doc>
    </field>
    <field name="iteration" type="NX_INT" units="NX_UNITLESS">
        <doc>
             Iteration or increment counter.
        </doc>
    </field>
    <group name="configuration" type="NXprocess">
        <doc>
             The configuration and parameterization of the reconstruction algorithm
             whereby the microstructural features were identified.
        </doc>
        <field name="dimensionality" type="NX_POSINT" units="NX_UNITLESS">
            <doc>
                 Dimensionality of Euclidean space in which the analysis is conducted.
                 
                 This field can be used e.g. by a research data management system to identify
                 if the description specifies one-, two-, or three-dimensional representations.
            </doc>
            <enumeration>
                <item value="1"/>
                <item value="2"/>
                <item value="3"/>
            </enumeration>
        </field>
        <field name="algorithm" type="NX_CHAR">
            <doc>
                 Algorithm is used to reconstruct the features.
            </doc>
            <enumeration>
                <item value="unknown"/>
                <item value="disorientation_clustering"/>
                <item value="fast_multiscale_clustering"/>
                <item value="markov_chain_clustering"/>
            </enumeration>
        </field>
        <field name="disorientation_threshold" type="NX_NUMBER" units="NX_ANGLE">
            <doc>
                 Threshold to define at which disorientation angle to assume
                 two crystalline regions have a significant orientation difference
                 which warrants to argue that there is an interface between the
                 two regions.
            </doc>
        </field>
    </group>
    <!--use controlled vocabulary terms point, line, surface, volume, use singular term-->
    <group type="NXcg_point_set"/>
    <group type="NXcg_polyline_set"/>
    <group type="NXcg_triangle_set"/>
    <group type="NXcg_polyhedron_set"/>
    <group type="NXcsg"/>
    <!--domain-specific, i.e. microstructural features-->
    <group name="crystal" type="NXobject">
        <doc>
             One- or two-dimensional projections, or three-dimensional representation of crystals.
             
             Crystals can be grains of different phases, precipitates, dispersoids, there are many
             terms used in specifically the materials engineering community.
             
             Typically, as observed e.g. on the surface of a sample using with optical or electron microscopy
             or as simulated as a set of pixel or evolving polygons and their polyline boundaries.
        </doc>
        <!--maybe some enum what this is-->
        <field name="representation" type="NX_CHAR">
            <doc>
                 Reference to an instance of:
                 
                 * :ref:`NXcg_point_set` for a one-dimensional representation as only a projection is available
                 * :ref:`NXcg_polyline_set` or :ref`NXcg_polygon_set` for a two-dimensional representation as only a projection is available
                 * :ref:`NXcg_polyhedron_set` for a three-dimensional representation
                 * :ref:`NXcg_grid` for regularly pixelated or voxelated representation
                 
                 Most microscopy techniques support to generate only a two-dimensional
                 representation (projection) of the characterized material.
            </doc>
        </field>
        <field name="number_of_crystals" type="NX_UINT" units="NX_UNITLESS">
            <doc>
                 Number of crystals.
            </doc>
        </field>
        <field name="number_of_phases" type="NX_UINT" units="NX_UNITLESS">
            <doc>
                 How many phases are distinguished
            </doc>
        </field>
        <field name="crystal_identifier_offset" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Integer offset whereby to distinguish crystals.
            </doc>
        </field>
        <field name="crystal_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Identifier used for crystals for explicit indexing.
            </doc>
        </field>
        <!--n_c_one, n_c_two, n_c-->
        <field name="phase_identifier_offset" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Integer offset whereby the identifier of the first member
                 of the set differs from zero.
            </doc>
        </field>
        <field name="phase_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Identifier used for phase for explicit indexing.
            </doc>
        </field>
        <!--n_c_one, n_c_two, n_c
properties
DESCRIPTOR VALUES, SUMMARY STATISTICS-->
        <field name="boundary_contact" type="NX_BOOLEAN">
            <doc>
                 True, if the crystal makes contact with the edge of the ROI false otherwise.
            </doc>
        </field>
        <!--n_c_one, n_c_two, n_c-->
        <field name="orientation_spread" type="NX_NUMBER" units="NX_ANGLE">
            <doc>
                 Average disorientation angle between individual orientation of the
                 crystal at probed positions (weighted by area of that position) versus
                 the average disorientation of the crystal.
            </doc>
        </field>
        <!--n_c_one, n_c_two, n_c-->
        <group type="NXrotation_set"/>
        <field name="length" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Length of each crystal
            </doc>
        </field>
        <field name="area" type="NX_NUMBER" units="NX_AREA">
            <doc>
                 Area of each crystal.
            </doc>
        </field>
        <field name="volume" type="NX_NUMBER" units="NX_VOLUME">
            <doc>
                 Volume of each crystal
            </doc>
        </field>
    </group>
    <group name="interface" type="NXobject">
        <doc>
             One- or two-dimensional projections, or three-dimensional representation of interfaces between crystals
             as topological entities to dual_junctions.
             
             Most relevant interfaces are grain and phase boundaries but factually interfaces can also be between
             the environment and crystals exposed at the surface of the specimen.
        </doc>
        <field name="representation" type="NX_CHAR">
            <doc>
                 Reference to an instance of:
                 
                 * :ref:`NXcg_point_set` for a one-dimensional representation as only a projection is available
                 * :ref:`NXcg_polyline_set` for a two-dimensional representation as only a projection is available
                 * :ref:`NXcg_grid` for regularly pixelated or voxelated representation using (boolean) masks
                 
                 Most microscopy techniques support to generate only a two-dimensional
                 representation (projection) of the characterized material.
            </doc>
        </field>
        <field name="number_of_interfaces" type="NX_UINT" units="NX_UNITLESS">
            <doc>
                 Number of interfaces.
            </doc>
        </field>
        <field name="identifier_offset" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Integer which specifies the first index to be used for distinguishing
                 interfaces.
            </doc>
        </field>
        <field name="identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Integer used to distinguish features for explicit indexing.
            </doc>
        </field>
        <!--n_i_one, n_i_two, n_i
topological view, interface specification through the the pair of crystals sharing an interface-->
        <field name="crystal" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Set of pairs of crystal_identifier.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="i"/>
                <dim index="2" value="2"/>
            </dimensions>
            <attribute name="use_these" type="NX_CHAR">
                <doc>
                     The specific identifier instance to resolve ambiguities.
                </doc>
            </attribute>
        </field>
        <!--topological view, interface specification through the pair of triple line projections (i.e. triple points) adjoining the interface-->
        <field name="triple_junction" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Set of pairs of triple_junction_identifier.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="j"/>
                <dim index="2" value="2"/>
            </dimensions>
            <attribute name="use_these" type="NX_CHAR">
                <doc>
                     The specific identifier instance to resolve ambiguities.
                </doc>
            </attribute>
        </field>
        <!--DESCRIPTOR VALUES-->
        <field name="length" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 The length of the interface.
                 
                 This is not necessarily the same as the length of the individual
                 polyline segments whereby the interface is discretized.
            </doc>
        </field>
        <!--n_i_one, n_i_two, n_i-->
        <field name="area" type="NX_NUMBER" units="NX_AREA">
            <doc>
                 Surface area
            </doc>
        </field>
    </group>
    <group name="triple_junction" type="NXobject">
        <doc>
             Projections of or representations of junctions at which interfaces between.
             
             Junctions can be triple lines, triple points as their projections, junctions observed
             between crystals at the specimen and its surface (including wetting phenomena)
        </doc>
        <field name="representation" type="NX_CHAR">
            <doc>
                 Reference to an instance of:
                 
                 * :ref:`NXcg_point_set` for a one-dimensional representation as only a projection is available
                 * :ref:`NXcg_polyline_set` for a two-dimensional representation as only a projection is available
                 * :ref:`NXcg_grid` for regularly pixelated or voxelated representation using (boolean) masks
            </doc>
        </field>
        <!--another view to describe a triple junction is via its topology/connection expressed either via
i) triplet of interface identifier-->
        <field name="number_of_junctions" type="NX_UINT" units="NX_UNITLESS">
            <doc>
                 Number of triple junctions.
            </doc>
        </field>
        <field name="identifier_offset" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Integer offset where to start counting instances of the set of junctions.
            </doc>
        </field>
        <field name="identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Identifier used for specifiying all members of the set of junctions.
            </doc>
        </field>
        <!--n_t_one, n_t_two, n_t
example i) triple point locations explicitly-->
        <field name="position" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Set of identifier for positions whereby to identify the location of each
                 junction.
            </doc>
            <attribute name="use_these" type="NX_CHAR">
                <doc>
                     The specific identifier whereby to resolve ambiguities.
                </doc>
            </attribute>
        </field>
        <!--example ii) three interface projections or interface segments adjoin a triple line and point-->
        <field name="interface" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Set of tuples of identifier of features connected to the junction.
            </doc>
            <attribute name="use_these" type="NX_CHAR">
                <doc>
                     The specific identifier to instances of interface identifiers whereby to resolve
                     ambiguities.
                </doc>
            </attribute>
        </field>
        <!--example iii) e.g. three polyline segments enter a triple point-->
        <field name="polyline" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Set of tuples of identifier for representation of discretized features connected
                 to the junction.
            </doc>
            <attribute name="use_these" type="NX_CHAR">
                <doc>
                     The specific identifier to instances of NXcg primitives whereby to resolve
                     ambiguities.
                </doc>
            </attribute>
        </field>
    </group>
    <!--DESCRIPTOR VALUES-->
</definition>
