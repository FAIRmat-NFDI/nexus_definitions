<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<!--
# NeXus - Neutron and X-ray Common Data Format
#
# Copyright (C) 2014-2024 NeXus International Advisory Committee (NIAC)
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 3 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#
# For further information, see http://www.nexusformat.org
-->
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" category="base" type="group" name="NXimage_set" extends="NXobject" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">
    <!--for details about NXimage_r_set_diff see
https://github.com/FAIRmat-NFDI/nexus_definitions/commit/0682943baaef54d4a6386b5433f9721af6d3d81b
and here contributed_definitions/NXimage_r_set_diff.nxdl.xml-->
    <symbols>
        <symbol name="n_img">
            <doc>
                 Number of images in the stack, for stacks the slowest direction.
            </doc>
        </symbol>
        <symbol name="n_k">
            <doc>
                 Number of pixels per image in the slow direction (k equivalent to z).
            </doc>
        </symbol>
        <symbol name="n_j">
            <doc>
                 Number of pixels per image in the fast direction (j equivalent to y).
            </doc>
        </symbol>
        <symbol name="n_i">
            <doc>
                 Number of pixels per image in the fastest direction (i equivalent to x).
            </doc>
        </symbol>
    </symbols>
    <doc>
         Base class for reporting a set of images in real or reciprocal space.
         
         For images in reciprocal space in practice, complex numbers are encoded via some
         formatted pair of real values. Typically, fast Algorithms for computing Fourier Transformations
         (FFT) are used to encode images in reciprocal (frequency) space. FFT libraries are used
         for implementing the key functionalities of these mathematical operations.
         
         Different libraries use different representations and encoding of the image computed.
         Details can be found in the respective sections of the typical FFT libraries
         
         * `FFTW by M. Frigo and S. G. Johnson &lt;https://www.fftw.org/fftw3_doc/Tutorial.html#Tutorial&gt;`_
         * `Intel MKL by the Intel Co. &lt;https://www.intel.com/content/www/us/en/docs/onemkl/developer-reference-c/2023-0/fourier-transform-functions.html&gt;`_
         * `cuFFT by the NVidia Co. &lt;https://docs.nvidia.com/cuda/cufft/index.html&gt;`_
         
         Users are strongly advised to inspect carefully which specific conventions
         their library uses to be able to store and modify the implementation of their
         code such that the serialized representations, as it is detailed here for NeXus,
         matches.
         
         It is frequently the case that several images are combined using processing. In this case,
         the number of images which are combined in a collection is not necessarily the same
         for each collection. The NXimage_set base class addresses this logical distinction through
         the notation of image_identifier and group_identifier.
         That is image identifier are always counting from offset in increments of one. Each image
         is an own entity. A group may contain no, or several such images.
    </doc>
    <group type="NXprocess">
        <doc>
             Details how NXdata instance were processed from detector readings/raw data.
        </doc>
        <group name="source" type="NXserialized">
            <doc>
                 Resolvable data artifact (e.g. filename) from which all values in the :ref:`NXdata`
                 instances in this :ref:`NXimage_set` were loaded during parsing.
                 
                 Possibility to document from which specific other serialized resource as the source
                 pieces of information were processed when using NeXus as a semantic file format
                 to serialize that information differently.
                 
                 The group in combination with an added field *absolute_path* therein adds context.
            </doc>
            <field name="absolute_path" type="NX_CHAR">
                <doc>
                     Reference to a location inside the artifact that points to the specific group of values
                     that were processed if the artifacts contains several groups of values and thus
                     further resolving of ambiguities is required.
                </doc>
            </field>
        </group>
        <!--mode(NX_CHAR):
  doc: |
   Imaging (data collection) mode of the instrument during acquisition.-->
        <field name="detector_identifier" type="NX_CHAR">
            <doc>
                 Link or name of an :ref:`NXdetector` instance with which the data were
                 collected.
            </doc>
        </field>
        <group type="NXprogram">
            <doc>
                 Program used for processing.
            </doc>
        </group>
    </group>
    <field name="space" type="NX_CHAR">
        <doc>
             The reference space in which the image set is defined.
        </doc>
        <enumeration>
            <item value="real"/>
            <item value="reciprocal"/>
        </enumeration>
    </field>
    <group name="image_oned" type="NXdata">
        <doc>
             One-dimensional image.
        </doc>
        <field name="real" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Real part of the image intensity per pixel.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
        </field>
        <field name="imag" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Imaginary part of the image intensity per pixel.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
        </field>
        <field name="intensity" type="NX_COMPLEX" units="NX_UNITLESS">
            <doc>
                 Image intensity as a complex number as an alternative
                 to real and imag fields if values are stored as interleaved
                 complex numbers.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
        </field>
        <field name="magnitude" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Magnitude of the image intensity.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
        </field>
        <field name="axis_i" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fastest direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fastest direction.
                </doc>
            </attribute>
        </field>
    </group>
    <group name="image_twod" type="NXdata">
        <doc>
             Two-dimensional image.
        </doc>
        <field name="real" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Real part of the image intensity per pixel.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_j"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="imag" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Imaginary part of the image intensity per pixel.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_j"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="magnitude" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Magnitude of the image intensity.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_j"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="intensity" type="NX_COMPLEX" units="NX_UNITLESS">
            <doc>
                 Image intensity as a complex number as an alternative
                 to real and imag fields if values are stored as interleaved
                 complex numbers.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_j"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="axis_j" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fast direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_j"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fast direction.
                </doc>
            </attribute>
        </field>
        <field name="axis_i" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fastest direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fastest direction.
                </doc>
            </attribute>
        </field>
    </group>
    <group name="image_threed" type="NXdata">
        <doc>
             Three-dimensional image.
        </doc>
        <field name="real" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Real part of the image intensity per pixel.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_k"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="imag" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Imaginary part of the image intensity per pixel.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_k"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="magnitude" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Magnitude of the image intensity.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_k"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="intensity" type="NX_COMPLEX" units="NX_UNITLESS">
            <doc>
                 Image intensity as a complex number as an alternative
                 to real and imag fields if values are stored as interleaved
                 complex numbers.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_k"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="axis_k" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along slow direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_k"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along slow direction.
                </doc>
            </attribute>
        </field>
        <field name="axis_j" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fast direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_j"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fast direction.
                </doc>
            </attribute>
        </field>
        <field name="axis_i" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fastest direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fastest direction.
                </doc>
            </attribute>
        </field>
    </group>
    <group name="stack_oned" type="NXdata">
        <doc>
             Collection of one-dimensional images.
        </doc>
        <field name="real" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Real part of the image intensity per pixel.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="imag" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Imaginary part of the image intensity per pixel.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="magnitude" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Magnitude of the image intensity.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="intensity" type="NX_COMPLEX" units="NX_UNITLESS">
            <doc>
                 Image intensity as a complex number as an alternative
                 to real and imag fields if values are stored as interleaved
                 complex numbers.
            </doc>
            <dimensions rank="2">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_i"/>
            </dimensions>
        </field>
        <field name="group_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Group identifier for each image.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_img"/>
            </dimensions>
        </field>
        <field name="image_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Image identifier
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_img"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Image identifier.
                </doc>
            </attribute>
        </field>
        <field name="axis_i" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fastest direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fastest direction.
                </doc>
            </attribute>
        </field>
    </group>
    <group name="stack_twod" type="NXdata">
        <doc>
             Collection of two-dimensional images.
        </doc>
        <field name="real" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Real part of the image intensity per pixel.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="imag" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Imaginary part of the image intensity per pixel.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="magnitude" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Magnitude of the image intensity.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="intensity" type="NX_COMPLEX" units="NX_UNITLESS">
            <doc>
                 Image intensity as a complex number as an alternative
                 to real and imag fields if values are stored as interleaved
                 complex numbers.
            </doc>
            <dimensions rank="3">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_j"/>
                <dim index="3" value="n_i"/>
            </dimensions>
        </field>
        <field name="group_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Group identifier for each image.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_img"/>
            </dimensions>
        </field>
        <field name="image_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Image identifier
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_img"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Image identifier.
                </doc>
            </attribute>
        </field>
        <field name="axis_y" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fast direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_j"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fast direction.
                </doc>
            </attribute>
        </field>
        <field name="axis_i" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fastest direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fastest direction.
                </doc>
            </attribute>
        </field>
    </group>
    <group name="stack_threed" type="NXdata">
        <doc>
             Collection of three-dimensional images.
        </doc>
        <field name="real" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Real part of the image intensity per pixel.
            </doc>
            <dimensions rank="4">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_k"/>
                <dim index="3" value="n_j"/>
                <dim index="4" value="n_i"/>
            </dimensions>
        </field>
        <field name="imag" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Imaginary part of the image intensity per pixel.
            </doc>
            <dimensions rank="4">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_k"/>
                <dim index="3" value="n_j"/>
                <dim index="4" value="n_i"/>
            </dimensions>
        </field>
        <field name="magnitude" type="NX_NUMBER" units="NX_UNITLESS">
            <doc>
                 Magnitude of the image intensity.
            </doc>
            <dimensions rank="4">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_k"/>
                <dim index="3" value="n_j"/>
                <dim index="4" value="n_i"/>
            </dimensions>
        </field>
        <field name="intensity" type="NX_COMPLEX" units="NX_UNITLESS">
            <doc>
                 Image intensity as a complex number as an alternative
                 to real and imag fields if values are stored as interleaved
                 complex numbers.
            </doc>
            <dimensions rank="4">
                <dim index="1" value="n_img"/>
                <dim index="2" value="n_k"/>
                <dim index="3" value="n_j"/>
                <dim index="4" value="n_i"/>
            </dimensions>
        </field>
        <field name="group_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Group identifier for each image.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_img"/>
            </dimensions>
        </field>
        <field name="image_identifier" type="NX_INT" units="NX_UNITLESS">
            <doc>
                 Image identifier
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_img"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Image identifier.
                </doc>
            </attribute>
        </field>
        <field name="axis_k" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along slow direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_k"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along slow direction.
                </doc>
            </attribute>
        </field>
        <field name="axis_j" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fast direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_j"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fast direction.
                </doc>
            </attribute>
        </field>
        <field name="axis_i" type="NX_NUMBER" units="NX_LENGTH">
            <doc>
                 Pixel coordinate center along fastest direction.
            </doc>
            <dimensions rank="1">
                <dim index="1" value="n_i"/>
            </dimensions>
            <attribute name="long_name" type="NX_CHAR">
                <doc>
                     Coordinate along fastest direction.
                </doc>
            </attribute>
        </field>
    </group>
</definition>
